\tikzset{
    % Block styles for testing pipeline - made larger to match training diagram
    test_block/.style={
        rectangle,
        draw=black,
        thick,
        minimum height=1.2cm,
        minimum width=1.8cm,
        rounded corners=8pt,
        font=\scriptsize\bfseries,
        text width=1.7cm,
        text centered,
        align=center,
        line width=1.2pt,
        drop shadow={shadow xshift=2pt, shadow yshift=-2pt, opacity=0.3}
    },
    inference_block/.style={
        test_block,
        fill=purple!65,
        draw=purple!85!black,
        text=white
    },
    coarse_gen_block/.style={
        test_block,
        fill=blue!70,
        draw=blue!90!black,
        text width=1.9cm,
        text=white
    },
    fine_gen_block/.style={
        test_block,
        fill=orange!75,
        draw=orange!90!black,
        text width=1.9cm,
        text=white
    }
}

\begin{tikzpicture}[
    scale=0.85,
    >=stealth,
    node distance=2.2cm
]

% Input test images - made larger
\node at (0, 0.6) {\includegraphics[width=1.0cm]{graphics/tikz_models/21557_1.png}};
\node at (0, -0.6) {\includegraphics[width=1.0cm]{graphics/tikz_models/21557_2.png}};
\node[font=\small\bfseries, color=gray!70!black] at (0, -1.6) {Test Images};

% Feature extraction
\node[inference_block] (features) at (3.0, 0) {Feature\\Extraction};

% Coarse mesh generation
\node[coarse_gen_block] (coarse_gen) at (6.5, 0) {Coarse\\Deformation};

% Coarse mesh output
\node at (10.0, 0) {\includegraphics[width=1.0cm]{graphics/tikz_models/21557_4.png}};
\node[font=\small, color=gray!70!black, text width=2.5cm, text centered] at (10.0, -1.3) {Coarse Mesh (2566 vertices)};

% Fine mesh refinement
\node[fine_gen_block] (fine_gen) at (13.5, 0) {Fine\\Deformation};

% Final refined mesh
\node at (17.0, 0) {\includegraphics[width=1.0cm]{graphics/tikz_models/21557_3.png}};
\node[font=\small, color=gray!70!black, text width=2.5cm, text centered] at (17.0, -1.3) {Fine Mesh (2566 vertices)};

% Flow arrows with different colors for different stages - made thicker and larger
\draw[->, line width=3pt, blue!80!black, -{Stealth[length=6pt,width=5pt]}] (1.0, 0) -- (features.west);
\draw[->, line width=3pt, blue!80!black, -{Stealth[length=6pt,width=5pt]}] (features.east) -- (coarse_gen.west);
\draw[->, line width=3pt, blue!80!black, -{Stealth[length=6pt,width=5pt]}] (coarse_gen.east) -- (9.0, 0);
\draw[->, line width=3pt, orange!80!black, -{Stealth[length=6pt,width=5pt]}] (11.0, 0) -- (fine_gen.west);
\draw[->, line width=3pt, orange!80!black, -{Stealth[length=6pt,width=5pt]}] (fine_gen.east) -- (16.0, 0);

% Add stage labels
\node[font=\small\bfseries, color=blue!80!black] at (7.75, 1.2) {Stage 1};
\node[font=\small\bfseries, color=orange!80!black] at (15.25, 1.2) {Stage 2};

\end{tikzpicture}